<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TINTIN - Complete seu Perfil</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .user-type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .type-option {
            padding: 20px;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .type-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .type-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea15, #764ba215);
        }

        .type-option .icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .type-option h3 {
            margin-bottom: 5px;
            color: #333;
        }

        .type-option p {
            font-size: 14px;
            color: #666;
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .add-item-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: end;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            margin-top: 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn-secondary {
            background: #667eea;
            color: white;
            padding: 12px 20px;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .interest-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }

        .interest-card .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4444;
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Complete seu Perfil</h1>
            <p>Escolha como voc√™ deseja participar</p>
        </div>

        <div class="card">
            <div class="user-type-selector">
                <div class="type-option" id="student-option" onclick="selectUserType('student')">
                    <div class="icon">üìö</div>
                    <h3>Quero Aprender</h3>
                    <p>Encontre professores para te ajudar</p>
                </div>
                <div class="type-option" id="teacher-option" onclick="selectUserType('teacher')">
                    <div class="icon">üë®‚Äçüè´</div>
                    <h3>Quero Ensinar</h3>
                    <p>Compartilhe seu conhecimento</p>
                </div>
            </div>

            <!-- Formul√°rio para Alunos -->
            <form id="student-form" class="form-section">
                <h2 style="margin-bottom: 20px;">O que voc√™ quer aprender?</h2>
                
                <div class="add-item-group">
                    <div style="display: grid; gap: 10px;">
                        <input type="text" id="interest-name" placeholder="Ex: Python, Trocar Chuveiro, Tocar Viol√£o...">
                        <select id="interest-difficulty">
                            <option value="beginner">Iniciante</option>
                            <option value="intermediate">Intermedi√°rio</option>
                            <option value="advanced">Avan√ßado</option>
                        </select>
                        <textarea id="interest-description" placeholder="Descreva o que voc√™ quer aprender (opcional)" rows="2"></textarea>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addInterest()">Adicionar</button>
                </div>

                <div id="interests-container" style="margin-top: 20px;"></div>

                <button type="submit" class="btn btn-primary">Concluir Cadastro</button>
                <div id="student-error" class="error-message"></div>
            </form>

            <!-- Formul√°rio para Professores -->
            <form id="teacher-form" class="form-section">
                <h2 style="margin-bottom: 20px;">O que voc√™ pode ensinar?</h2>
                
                <div class="add-item-group">
                    <div style="display: grid; gap: 10px;">
                        <input type="text" id="skill-name" placeholder="Ex: Python, Eletricista, Viol√£o...">
                        <textarea id="skill-description" placeholder="Descreva sua experi√™ncia (opcional)" rows="2"></textarea>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addSkill()">Adicionar</button>
                </div>

                <div id="skills-container" style="margin-top: 20px;"></div>

                <button type="submit" class="btn btn-primary">Concluir Cadastro</button>
                <div id="teacher-error" class="error-message"></div>
            </form>
        </div>
    </div>

    <script>
        // Detectar URL da API automaticamente (localhost ou Codespace)
        const API_BASE = window.location.origin.includes('github.dev') 
            ? window.location.origin 
            : 'http://localhost:5000';
        const API_URL = `${API_BASE}/api/profile`;
        
        console.log('üåê API URL detectada:', API_URL);
        
        let selectedUserType = null;
        let interests = [];
        let skills = [];

        function selectUserType(type) {
            selectedUserType = type;
            
            // Remover sele√ß√£o anterior
            document.getElementById('student-option').classList.remove('selected');
            document.getElementById('teacher-option').classList.remove('selected');
            
            // Adicionar sele√ß√£o no clicado
            document.getElementById(`${type}-option`).classList.add('selected');
            
            // Mostrar formul√°rio correto
            document.querySelectorAll('.form-section').forEach(form => form.classList.remove('active'));
            document.getElementById(`${type}-form`).classList.add('active');
        }

        function addInterest() {
            const name = document.getElementById('interest-name').value.trim();
            const difficulty = document.getElementById('interest-difficulty').value;
            const description = document.getElementById('interest-description').value.trim();

            if (!name) {
                alert('Por favor, digite o que voc√™ quer aprender');
                return;
            }

            interests.push({ name, difficulty, description });
            renderInterests();
            
            document.getElementById('interest-name').value = '';
            document.getElementById('interest-description').value = '';
        }

        function renderInterests() {
            const container = document.getElementById('interests-container');
            container.innerHTML = interests.map((interest, index) => `
                <div class="interest-card">
                    <button class="remove-btn" onclick="removeInterest(${index})">√ó</button>
                    <strong>${interest.name}</strong>
                    <div style="color: #666; font-size: 14px; margin-top: 5px;">
                        N√≠vel: ${interest.difficulty === 'beginner' ? 'Iniciante' : interest.difficulty === 'intermediate' ? 'Intermedi√°rio' : 'Avan√ßado'}
                    </div>
                    ${interest.description ? `<div style="color: #666; font-size: 14px; margin-top: 5px;">${interest.description}</div>` : ''}
                </div>
            `).join('');
        }

        function removeInterest(index) {
            interests.splice(index, 1);
            renderInterests();
        }

        function addSkill() {
            const name = document.getElementById('skill-name').value.trim();
            const description = document.getElementById('skill-description').value.trim();

            if (!name) {
                alert('Por favor, digite o que voc√™ pode ensinar');
                return;
            }

            skills.push({ name, description });
            renderSkills();
            
            document.getElementById('skill-name').value = '';
            document.getElementById('skill-description').value = '';
        }

        function renderSkills() {
            const container = document.getElementById('skills-container');
            container.innerHTML = skills.map((skill, index) => `
                <div class="interest-card">
                    <button class="remove-btn" onclick="removeSkill(${index})">√ó</button>
                    <strong>${skill.name}</strong>
                    ${skill.description ? `<div style="color: #666; font-size: 14px; margin-top: 5px;">${skill.description}</div>` : ''}
                </div>
            `).join('');
        }

        function removeSkill(index) {
            skills.splice(index, 1);
            renderSkills();
        }

        // Submit do formul√°rio de aluno
        document.getElementById('student-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (interests.length === 0) {
                document.getElementById('student-error').textContent = 'Adicione pelo menos um interesse';
                document.getElementById('student-error').classList.add('show');
                return;
            }

            await completeProfile('student', { interests });
        });

        // Submit do formul√°rio de professor
        document.getElementById('teacher-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (skills.length === 0) {
                document.getElementById('teacher-error').textContent = 'Adicione pelo menos uma habilidade';
                document.getElementById('teacher-error').classList.add('show');
                return;
            }

            await completeProfile('teacher', { skills });
        });

        async function completeProfile(userType, data) {
            const token = localStorage.getItem('authToken');

            try {
                console.log('üì§ Enviando para:', `${API_URL}/complete`);
                console.log('üì§ Dados:', { user_type: userType, ...data });

                const response = await fetch(`${API_URL}/complete`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        user_type: userType,
                        ...data
                    })
                });

                const result = await response.json();
                console.log('üì• Resposta:', result);

                if (response.ok) {
                    localStorage.setItem('userType', userType);
                    window.location.href = '/discover.html';
                } else {
                    document.getElementById(`${userType}-error`).textContent = result.error || 'Erro ao salvar perfil';
                    document.getElementById(`${userType}-error`).classList.add('show');
                }
            } catch (error) {
                console.error('‚ùå Erro:', error);
                document.getElementById(`${userType}-error`).textContent = 'Erro ao salvar perfil';
                document.getElementById(`${userType}-error`).classList.add('show');
            }
        }

        // Verificar se est√° logado
        window.addEventListener('DOMContentLoaded', () => {
            if (!localStorage.getItem('authToken')) {
                window.location.href = '/login.html';
            }
        });
    </script>
</body>
</html>